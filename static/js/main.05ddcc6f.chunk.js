(this["webpackJsonpmoex-bonds"]=this["webpackJsonpmoex-bonds"]||[]).push([[0],{111:function(e,n,t){},113:function(e,n,t){},114:function(e,n,t){},115:function(e,n,t){},116:function(e,n,t){},117:function(e,n,t){},118:function(e,n,t){},119:function(e,n,t){"use strict";t.r(n);var a,r=t(0),o=t.n(r),c=t(9),i=t.n(c),l=(t(88),t(89),t(19)),u=t.n(l),s=t(33),d=t(30),m=t(20),p=t(10),f=(a={},Object(m.a)(a,"GET_ALL_BONDS",(function(e,n){return Object(p.a)(Object(p.a)({},e),{},{initialBonds:n.payload.initialBonds,bonds:n.payload.bonds,loading:!1})})),Object(m.a)(a,"GET_ALL_BOARDS",(function(e,n){return Object(p.a)(Object(p.a)({},e),{},{boards:n.payload,loading:!1})})),Object(m.a)(a,"SET_LOADING",(function(e){return Object(p.a)(Object(p.a)({},e),{},{loading:!0})})),Object(m.a)(a,"SET_FILTER",(function(e,n){return Object(p.a)(Object(p.a)({},e),{},{filter:n.payload.filter,bonds:n.payload.bonds})})),Object(m.a)(a,"SET_FILTERED_BONDS",(function(e,n){return Object(p.a)(Object(p.a)({},e),{},{bonds:n.payload})})),Object(m.a)(a,"SET_PORTFOLIO",(function(e,n){return Object(p.a)(Object(p.a)({},e),{},{portfolio:n.payload})})),Object(m.a)(a,"DEFAULT",(function(e){return e})),a),b=function(e,n){return(f[n.type]||f.DEFAULT)(e,n)},h=o.a.createContext(),E="3",v=[{type:E,name:"\u0413\u043e\u0441\u0443\u0434\u0430\u0440\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438 "},{type:"4",name:"\u0420\u0435\u0433\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438 "},{type:"5",name:"\u041e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438 \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u044b\u0445 \u0431\u0430\u043d\u043a\u043e\u0432 "},{type:"6",name:"\u041a\u043e\u0440\u043f\u043e\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u043e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438 "},{type:"7",name:"\u041e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438 \u041c\u0424\u041e"},{type:"8",name:"\u0411\u0438\u0440\u0436\u0435\u0432\u044b\u0435 \u043e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438"},{type:"C",name:"\u041c\u0443\u043d\u0438\u0446\u0438\u043f\u0430\u043b\u044c\u043d\u044b\u0435 \u043e\u0431\u043b\u0438\u0433\u0430\u0446\u0438\u0438"}],g=t(54),O=t.n(g),y=function(e,n){var t={};return n.forEach((function(n,a){t[n]=e[a]})),t},P=function(e,n){return e.map((function(e){var t=y(e,n),a="0000-00-00"!=t.MATDATE?t.MATDATE:t.BUYBACKDATE,r=j(t.NEXTCOUPON,"0000-00-00"!=t.MATDATE?t.MATDATE:t.BUYBACKDATE,t.COUPONPERIOD),o="0000-00-00"!=t.MATDATE?t.LOTVALUE:t.BUYBACKPRICE,c={name:t.SHORTNAME,price:t.PREVPRICE,expireDate:a,coupon:t.COUPONVALUE,couponPeriod:t.COUPONPERIOD,couponPercent:t.YIELDATPREVWAPRICE,couponDate:t.NEXTCOUPON,couponAccumulated:t.ACCRUEDINT,couponCount:r,currency:t.FACEUNIT,value:o,board:t.BOARDID,isin:t.ISIN,months:N(t.NEXTCOUPON,t.MATDATE,t.COUPONPERIOD),type:t.SECTYPE};return c.profitPercent=D(c),"\u0424\u0438\u043d\u0410\u0432\u0438\u0430 01"===e[2]&&(console.log(t),console.log(c)),"RUS-28"===e[2]&&(console.log(t),console.log(c)),c}))},N=function(e,n,t){for(var a=new Date(e),r=new Date(n),o={},c=Math.floor(368/t);a<=r&&Object.keys(o).length<c;)o[a.getMonth()+1]=a,a.setDate(a.getDate()+t);return Object.keys(o).map((function(e){return parseInt(e)}))},j=function(e,n,t){var a=new Date(e),r=new Date(n);return Math.round((r-a)/864e5/t+1)},D=function(e){var n=new Date,t=new Date(e.expireDate),a=Math.abs(t-n)/31556952e3,r=e.value*e.price/100,o=e.couponCount*e.coupon+e.value-e.couponAccumulated;return Math.round(Math.log(o/r)/a*100*100)/100},T=("".concat("https://iss.moex.com/iss","/index.json"),"".concat("https://iss.moex.com/iss","/engines/stock/markets/bonds/securities.json")),C=function(){var e=Object(s.a)(u.a.mark((function e(){var n,t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.get(T);case 2:return n=e.sent,t=n.data.securities.columns,a=n.data.securities.data,e.abrupt("return",P(a,t));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(e){var n=e.children,t={boards:[],bonds:[],filter:{boards:["TQOD","TQOB","TQCB"],currencies:["SUR"],month:null,types:[E]},initialBonds:[],loading:!1,portfolio:[]},a=Object(r.useReducer)(b,t),c=Object(d.a)(a,2),i=c[0],l=c[1],m=function(){var e=Object(s.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(),e.next=3,C();case 3:n=e.sent,l({type:"GET_ALL_BONDS",payload:{initialBonds:n,bonds:p(n,i.filter)}});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(e,n){var t=n.boards,a=n.currencies,r=n.month,o=n.types;return e.concat().filter((function(e){return t.includes(e.board)&&a.includes(e.currency)&&o.includes(e.type)&&(!r||e.months.includes(r))&&null!=e.price&&e.coupon>0}))},f=function(){l({type:"SET_LOADING"})},v=i.bonds,g=i.filter,O=i.portfolio;return o.a.createElement(h.Provider,{value:{bonds:v,filter:g,portfolio:O,getBonds:m,setFilter:function(e){l({type:"SET_FILTER",payload:{filter:e,bonds:p(i.initialBonds,e)}})},setPortfolio:function(e){l({type:"SET_PORTFOLIO",payload:e})}}},n)},w=t(163),x=t(157),M=t(158),I=t(159),k=t(167),B=t(150),F=t(154),R=function(e){var n=e.row,t=e.columns;return o.a.createElement(B.a,{hover:!0},t.map((function(e){return o.a.createElement(F.a,{key:e.id,align:e.numeric?"right":"left"},e.template&&"function"==typeof e.template?e.template(n):n[e.id])})))},S=t(155),L=t(172),U=function(e){var n=e.classes,t=e.columns,a=e.order,r=e.orderBy,c=e.onRequestSort;return o.a.createElement(S.a,null,o.a.createElement(B.a,null,t.map((function(e){return o.a.createElement(F.a,{key:e.id,align:e.numeric?"right":"left",padding:e.disablePadding?"none":"default",sortDirection:r===e.id&&a},o.a.createElement(L.a,{active:r===e.id,direction:r===e.id?a:"asc",onClick:(t=e.id,function(e){c(e,t)})},e.label,r===e.id?o.a.createElement("span",{className:n.visuallyHidden},"desc"===a?"sorted descending":"sorted ascending"):null));var t}))))},_=[{id:"name",numeric:!1,disablePadding:!0,label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"},{id:"value",numeric:!0,disablePadding:!0,label:"\u041d\u043e\u043c\u0438\u043d\u0430\u043b"},{id:"price",numeric:!0,disablePadding:!1,label:"\u0422\u0435\u043a.\u0426\u0435\u043d\u0430"},{id:"expireDate",numeric:!1,disablePadding:!1,label:"\u041f\u043e\u0433\u0430\u0448\u0435\u043d\u0438\u0435"},{id:"couponPeriod",numeric:!0,disablePadding:!0,label:"\u041f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c"},{id:"coupon",numeric:!0,disablePadding:!1,label:"\u041a\u0443\u043f\u043e\u043d"},{id:"couponPercent",numeric:!0,disablePadding:!1,label:"\u0414\u043e\u0445\u043e\u0434\u043d\u043e\u0441\u0442\u044c"}];function Y(e,n,t){return n[t]<e[t]?-1:n[t]>e[t]?1:0}var G=t(156),V=Object(G.a)((function(e){return{root:{width:"100%"},paper:{width:"100%",marginBottom:e.spacing(2)},table:{minWidth:750},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1}}})),W=function(e){var n=V(),t=o.a.useState("asc"),a=Object(d.a)(t,2),r=a[0],c=a[1],i=o.a.useState("calories"),l=Object(d.a)(i,2),u=l[0],s=l[1],m=o.a.useState(0),p=Object(d.a)(m,2),f=p[0],b=p[1],h=o.a.useState(10),E=Object(d.a)(h,2),v=E[0],g=E[1],O=e.bonds;return o.a.createElement(o.a.Fragment,null,o.a.createElement(x.a,null,o.a.createElement(M.a,{size:"small"},o.a.createElement(U,{classes:n,columns:e.columns||_,order:r,orderBy:u,onRequestSort:function(e,n){c(u===n&&"asc"===r?"desc":"asc"),s(n)},rowCount:O.length}),o.a.createElement(I.a,null,function(e,n){var t=e.map((function(e,n){return[e,n]}));return t.sort((function(e,t){var a=n(e[0],t[0]);return 0!==a?a:e[1]-t[1]})),t.map((function(e){return e[0]}))}(O,function(e,n){return"desc"===e?function(e,t){return Y(e,t,n)}:function(e,t){return-Y(e,t,n)}}(r,u)).slice(f*v,f*v+v).map((function(n){return o.a.createElement(R,{key:n.name,row:n,columns:e.columns||_})}))))),o.a.createElement(k.a,{rowsPerPageOptions:[10,15,20,25,30],component:"div",count:O.length,rowsPerPage:v,page:f,onChangePage:function(e,n){b(n)},onChangeRowsPerPage:function(e){g(parseInt(e.target.value,10)),b(0)}}))},H=t(74),K=t.n(H),Q=(t(111),function(){var e=Object(r.useContext)(h),n=e.bonds,t=e.portfolio,a=e.setPortfolio;return o.a.createElement("div",null,o.a.createElement(W,{bonds:n,columns:[{id:"name",numeric:!1,disablePadding:!1,label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",template:function(e){return o.a.createElement(w.a,{target:"_blank",href:"https://www.moex.com/ru/issue.aspx?board=".concat(e.board,"&code=").concat(e.isin)},e.name)}},{id:"value",numeric:!0,disablePadding:!0,label:"\u041d\u043e\u043c\u0438\u043d\u0430\u043b"},{id:"expireDate",numeric:!0,disablePadding:!1,label:"\u041f\u043e\u0433\u0430\u0448\u0435\u043d\u0438\u0435"},{id:"couponCount",numeric:!0,disablePadding:!1,label:"\u041a\u0443\u043f\u043e\u043d\u043e\u0432"},{id:"couponPeriod",numeric:!0,disablePadding:!1,label:"\u041f\u0435\u0440\u0438\u043e\u0434"},{id:"coupon",numeric:!0,disablePadding:!1,label:"\u041a\u0443\u043f\u043e\u043d"},{id:"couponAccumulated",numeric:!0,disablePadding:!1,label:"\u041d\u041a\u0414"},{id:"price",numeric:!0,disablePadding:!1,label:"\u0422\u0435\u043a.\u0426\u0435\u043d\u0430"},{id:"couponPercent",numeric:!0,disablePadding:!1,label:"\u0414\u043e\u0445\u043e\u0434\u043d\u043e\u0441\u0442\u044c (\u0411\u0438\u0440\u0436)"},{id:"profitPercent",numeric:!0,disablePadding:!1,label:"\u0414\u043e\u0445\u043e\u0434\u043d\u043e\u0441\u0442\u044c (\u0420\u0430\u0441\u0447)"},{id:"isin",numeric:!1,disablePadding:!1,template:function(e){return o.a.createElement(w.a,{className:"add-link",onClick:function(){return function(e){var n=t.concat(),r=n.filter((function(n){return n.bond.isin==e.isin}));r.length?r[0].count++:n.push({count:1,bond:e}),a(n)}(e)}},o.a.createElement(K.a,null))}}]}))}),X=t(164),q=t(170),J=t(166),z=t(173),$=t(161),Z=t(168),ee=t(165),ne=["\u042f\u043d\u0432","\u0424\u0435\u0432","\u041c\u0430\u0440","\u0410\u043f\u0440","\u041c\u0430\u0439","\u0418\u044e\u043d","\u0418\u044e\u043b","\u0410\u0432\u0433","\u0421\u0435\u043d","\u041e\u043a\u0442","\u041d\u043e\u044f","\u0414\u0435\u043a"],te=(t(113),function(){var e=Object(r.useContext)(h),n=e.filter,t=e.setFilter;return o.a.createElement("div",{className:"filter"},o.a.createElement(X.a,{className:"select-month"},o.a.createElement(q.a,{id:"filter-month"},"\u041c\u0435\u0441\u044f\u0446 \u0432\u044b\u043f\u043b\u0430\u0442"),o.a.createElement(J.a,{labelId:"filter-month",value:n.month||0,onChange:function(e){var a=e.target.value,r=Object(p.a)({},n);r.month=a,t(r)}},o.a.createElement(z.a,{value:0},"\u0412\u0441\u0435"),ne.map((function(e,n){return o.a.createElement(z.a,{value:n+1,key:n+1},e)})))),o.a.createElement(X.a,null,o.a.createElement(q.a,{id:"filter-type"},"\u0422\u0438\u043f"),o.a.createElement(J.a,{multiple:!0,labelId:"filter-type",value:n.types,onChange:function(e){var a=e.target.value,r=Object(p.a)({},n);r.types=a,t(r)},input:o.a.createElement($.a,null),renderValue:function(e){return e.map((function(e){var n=v.findIndex((function(n){return n.type==e}));if(-1!=n)return v[n].name})).join(",")}},v.map((function(e){return o.a.createElement(z.a,{key:e.type,value:e.type},o.a.createElement(Z.a,{checked:n.types.indexOf(e.type)>-1}),o.a.createElement(ee.a,{primary:e.name}))})))))}),ae=t(171),re=t(75),oe=t.n(re),ce=(t(114),function(e){var n=e.bond,t=e.count,a=e.changeCount,r=e.removeItem;return o.a.createElement("div",{className:"bond"},o.a.createElement("div",{className:"name"},o.a.createElement(w.a,{className:"remove-item",onClick:function(){return r(n)}},o.a.createElement(oe.a,null)),n.name," (",n.expireDate,")"),o.a.createElement("div",{className:"coupon"},n.couponPercent,"%"),o.a.createElement("div",{className:"count"},o.a.createElement(ae.a,{type:"number",value:t,onChange:function(e){return a(e,n)}})),o.a.createElement("div",{className:"cost"},function(e,n){var t=parseFloat(e.value),a=parseFloat(e.price),r=parseFloat(e.couponAccumulated);return Math.round(t*a*n/100)+r*n}(n,t)," \u0440."))}),ie=(t(115),function(e){var n=Object(r.useContext)(h),t=n.portfolio,a=n.setPortfolio,c=function(e,n){var r=t.concat();r.filter((function(e){return e.bond.isin==n.isin}))[0].count=e.target.value,a(r)},i=function(e){var n=t.concat().filter((function(n){return n.bond.isin!=e.isin}));a(n)};return o.a.createElement("div",{className:"portfolio"},o.a.createElement("h2",null,"\u041f\u043e\u0440\u0442\u0444\u0435\u043b\u044c"),!!t.length&&o.a.createElement("div",{className:"list"},t.map((function(e){return o.a.createElement(ce,{key:e.bond.isin,bond:e.bond,count:e.count,changeCount:c,removeItem:i})})),o.a.createElement("div",{className:"total"},function(){var e=0;return t.map((function(n){return e+=function(e,n){var t=parseFloat(e.value),a=parseFloat(e.price),r=parseFloat(e.couponAccumulated);return Math.round(t*a*n/100)+r*n}(n.bond,n.count)})),Math.round(100*e)/100}()," \u0440.")),!t.length&&o.a.createElement("p",{className:"empty"},"\u0417\u0434\u0435\u0441\u044c \u043f\u043e\u043a\u0430 \u043f\u0443\u0441\u0442\u043e"))}),le=t(55),ue=(t(116),function(){var e=Object(r.useContext)(h).portfolio,n={},t=0,a=function(e){return n[e]?n[e].coupon:0},c=function(e){var n=100*a(e)/t;return n<8&&(n=8),n+"%"};e.map((function(e){e.bond.months.map((function(t){n[t]||(n[t]={items:[],coupon:0}),n[t].items.push(e),n[t].coupon=function(e){var n=0;return e.map((function(e){n+=e.count*parseFloat(e.bond.coupon)})),Math.round(n)}(n[t].items)}))}));var i=Object.keys(n).map((function(e){return n[e].coupon}));return t=Math.max.apply(Math,Object(le.a)(i)),o.a.createElement("div",{className:"chart-container"},o.a.createElement("h2",null,"\u0412\u044b\u043f\u043b\u0430\u0442\u044b"),o.a.createElement("div",{className:"chart"},ne.map((function(e,n){return o.a.createElement("div",{key:e,className:"month",style:{height:c(n+1)}},o.a.createElement("div",{className:"price"},a(n+1),"\u0440"),o.a.createElement("div",{className:"label"},e))}))))}),se=(t(117),t(118),function(){var e=Object(r.useContext)(h).portfolio,n=[],t=[],a=e.map((function(e){return Object(p.a)(Object(p.a)({},e.bond),{},{count:e.count})})).sort((function(e,n){return e.expireDate<n.expireDate?-1:1}));a.length&&function(){var e=new Date,r=e.getMonth()+1,o=function(e,n){var t;return t=12*(n.getFullYear()-e.getFullYear()),t-=e.getMonth(),(t+=n.getMonth())<=0?0:t}(e,new Date(a[a.length-1].expireDate));t=new Array(o+1);for(var c=0;c<a.length;c++)for(var i=a[c],l=i.months.filter((function(e){return e>r})),u=l.length?i.months.indexOf(l[0]):0,s=0,d=i.months[u]-r,m=i.months.length>1?i.months[1]-i.months[0]:0,p=0;p<i.couponCount;p++)s=i.months[u],n.push({bond:i,month:s,inMonths:d,type:"coupon",value:i.coupon*i.count}),++u>=i.months.length&&(u=0),p==i.couponCount-1&&n.push({bond:i,month:s,inMonths:d,type:"expiration",value:i.value*i.count}),d+=m;n.sort((function(e,n){return e.inMonths<n.inMonths?-1:1}));for(var f=function(e){var a,r=n.filter((function(n){return n.inMonths<e+1}));t[e]=(a=r.map((function(e){return e.value}))).length?Math.round(100*a.reduce((function(e,n){return e+n})))/100:0},b=0;b<t.length;b++)f(b)}();var c=function(e){return Math.round(100*e)/100},i=function(){var n=0;return e.map((function(e){return n+=function(e,n){var t=parseFloat(e.value),a=parseFloat(e.price),r=parseFloat(e.couponAccumulated);return Math.round(t*a*n/100)+r*n}(e.bond,e.count)})),Math.round(100*n)/100}(),l=t[t.length-1]||0,u=c(l-i),s=t.length>100?t.concat().splice(t.length-100):t,d=c(t.length/12),m=i>0?c(Math.log(l/i)/d*100):0;return o.a.createElement("div",{className:"chart-cumulative-container"},o.a.createElement("h2",null,"\u0412\u043e\u0437\u0432\u0440\u0430\u0442"),o.a.createElement("p",null,"\u0427\u0435\u0440\u0435\u0437 ",t.length," \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u0432\u043e\u0437\u0432\u0440\u0430\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432 \u0441\u043e\u0441\u0442\u0430\u0432\u0438\u0442 ",l,"\u0440.",o.a.createElement("br",null),"\u041f\u0440\u0438\u0431\u044b\u043b\u044c \u0447\u0435\u0440\u0435\u0437 ",o.a.createElement("b",null,d)," \u043b\u0435\u0442 \u0441\u043e\u0441\u0442\u0430\u0432\u0438\u0442 ",u,"\u0440. \u0438\u043b\u0438 ",o.a.createElement("b",null,m,"%")," \u0433\u043e\u0434\u043e\u0432\u044b\u0445."),o.a.createElement("div",{className:"chart-cumulative"},s.map((function(e,n){return o.a.createElement("div",{key:n,className:"chart-cumulative-bar",style:{height:(t=e,100*t/s[s.length-1]+"%")}},o.a.createElement("div",{className:"return"},e),o.a.createElement("div",{className:"month"},n+1));var t}))))}),de=function(){var e=Object(r.useContext)(h).getBonds;return Object(r.useEffect)((function(){e()}),[]),o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"portfolio-chart"},o.a.createElement(ue,null)),o.a.createElement("div",{className:"returns-chart"},o.a.createElement(se,null)),o.a.createElement("div",{className:"bonds-filter"},o.a.createElement(te,null)),o.a.createElement("div",{className:"bonds-list"},o.a.createElement(Q,null)),o.a.createElement("div",{className:"portfolio-list"},o.a.createElement(ie,null)))};var me=function(){return o.a.createElement(A,null,o.a.createElement(de,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(me,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},83:function(e,n,t){e.exports=t(119)},88:function(e,n,t){},89:function(e,n,t){}},[[83,1,2]]]);
//# sourceMappingURL=main.05ddcc6f.chunk.js.map