(this["webpackJsonpmoex-bonds"]=this["webpackJsonpmoex-bonds"]||[]).push([[0],{108:function(e,n,t){},110:function(e,n,t){},111:function(e,n,t){},112:function(e,n,t){},113:function(e,n,t){},114:function(e,n,t){},115:function(e,n,t){},116:function(e,n,t){"use strict";t.r(n);var a,r=t(0),o=t.n(r),c=t(8),i=t.n(c),u=(t(85),t(86),t(18)),l=t.n(u),s=t(31),d=t(29),m=t(19),f=t(10),p=(a={},Object(m.a)(a,"GET_ALL_BONDS",(function(e,n){return Object(f.a)(Object(f.a)({},e),{},{initialBonds:n.payload.initialBonds,bonds:n.payload.bonds,loading:!1})})),Object(m.a)(a,"GET_ALL_BOARDS",(function(e,n){return Object(f.a)(Object(f.a)({},e),{},{boards:n.payload,loading:!1})})),Object(m.a)(a,"SET_LOADING",(function(e){return Object(f.a)(Object(f.a)({},e),{},{loading:!0})})),Object(m.a)(a,"SET_FILTER",(function(e,n){return Object(f.a)(Object(f.a)({},e),{},{filter:n.payload.filter,bonds:n.payload.bonds})})),Object(m.a)(a,"SET_FILTERED_BONDS",(function(e,n){return Object(f.a)(Object(f.a)({},e),{},{bonds:n.payload})})),Object(m.a)(a,"SET_PORTFOLIO",(function(e,n){return Object(f.a)(Object(f.a)({},e),{},{portfolio:n.payload})})),Object(m.a)(a,"DEFAULT",(function(e){return e})),a),b=function(e,n){return(p[n.type]||p.DEFAULT)(e,n)},h=o.a.createContext(),E=t(52),v=t.n(E),g=function(e,n){var t={};return n.forEach((function(n,a){t[n]=e[a]})),t},O=function(e,n){return e.map((function(e){var t=g(e,n),a={name:t.SHORTNAME,price:t.PREVPRICE,expireDate:"0000-00-00"!=t.MATDATE?t.MATDATE:t.BUYBACKDATE,coupon:t.COUPONVALUE,couponPeriod:t.COUPONPERIOD,couponPercent:t.YIELDATPREVWAPRICE,couponDate:t.NEXTCOUPON,couponAccumulated:t.ACCRUEDINT,couponCount:N(t.NEXTCOUPON,"0000-00-00"!=t.MATDATE?t.MATDATE:t.BUYBACKDATE,t.COUPONPERIOD),currency:t.FACEUNIT,value:"0000-00-00"!=t.MATDATE?t.LOTVALUE:t.BUYBACKPRICE,board:t.BOARDID,isin:t.ISIN,months:P(t.NEXTCOUPON,t.MATDATE,t.COUPONPERIOD)};return"\u0424\u0438\u043d\u0410\u0432\u0438\u0430 01"===e[2]&&(console.log(t),console.log(a)),a}))},P=function(e,n,t){for(var a=new Date(e),r=new Date(n),o={},c=Math.floor(368/t);a<=r&&Object.keys(o).length<c;)o[a.getMonth()+1]=a,a.setDate(a.getDate()+t);return Object.keys(o).map((function(e){return parseInt(e)}))},N=function(e,n,t){var a=new Date(e),r=new Date(n);return Math.round((r-a)/864e5/t+1)},j=("".concat("https://iss.moex.com/iss","/index.json"),"".concat("https://iss.moex.com/iss","/engines/stock/markets/bonds/securities.json")),y=function(){var e=Object(s.a)(l.a.mark((function e(){var n,t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get(j);case 2:return n=e.sent,t=n.data.securities.columns,a=n.data.securities.data,e.abrupt("return",O(a,t));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(e){var n=e.children,t=Object(r.useReducer)(b,{boards:[],bonds:[],filter:{boards:["TQOD","TQOB","TQCB"],currencies:["SUR"],month:null},initialBonds:[],loading:!1,portfolio:[]}),a=Object(d.a)(t,2),c=a[0],i=a[1],u=function(){var e=Object(s.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(),e.next=3,y();case 3:n=e.sent,i({type:"GET_ALL_BONDS",payload:{initialBonds:n,bonds:m(n,c.filter)}});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(e,n){var t=n.boards,a=n.currencies,r=n.month;return e.concat().filter((function(e){return t.includes(e.board)&&a.includes(e.currency)&&(!r||e.months.includes(r))&&null!=e.price&&e.coupon>0}))},f=function(){i({type:"SET_LOADING"})},p=c.bonds,E=c.filter,v=c.portfolio;return o.a.createElement(h.Provider,{value:{bonds:p,filter:E,portfolio:v,getBonds:u,setFilter:function(e){i({type:"SET_FILTER",payload:{filter:e,bonds:m(c.initialBonds,e)}})},setPortfolio:function(e){i({type:"SET_PORTFOLIO",payload:e})}}},n)},T=t(160),A=t(155),C=t(156),w=t(157),x=t(163),M=t(148),B=t(152),I=function(e){var n=e.row,t=e.columns;return o.a.createElement(M.a,{hover:!0},t.map((function(e){return o.a.createElement(B.a,{key:e.id,align:e.numeric?"right":"left"},e.template&&"function"==typeof e.template?e.template(n):n[e.id])})))},k=t(153),F=t(165),R=function(e){var n=e.classes,t=e.columns,a=e.order,r=e.orderBy,c=e.onRequestSort;return o.a.createElement(k.a,null,o.a.createElement(M.a,null,t.map((function(e){return o.a.createElement(B.a,{key:e.id,align:e.numeric?"right":"left",padding:e.disablePadding?"none":"default",sortDirection:r===e.id&&a},o.a.createElement(F.a,{active:r===e.id,direction:r===e.id?a:"asc",onClick:(t=e.id,function(e){c(e,t)})},e.label,r===e.id?o.a.createElement("span",{className:n.visuallyHidden},"desc"===a?"sorted descending":"sorted ascending"):null));var t}))))},S=[{id:"name",numeric:!1,disablePadding:!0,label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"},{id:"value",numeric:!0,disablePadding:!0,label:"\u041d\u043e\u043c\u0438\u043d\u0430\u043b"},{id:"price",numeric:!0,disablePadding:!1,label:"\u0422\u0435\u043a.\u0426\u0435\u043d\u0430"},{id:"expireDate",numeric:!1,disablePadding:!1,label:"\u041f\u043e\u0433\u0430\u0448\u0435\u043d\u0438\u0435"},{id:"couponPeriod",numeric:!0,disablePadding:!0,label:"\u041f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c"},{id:"coupon",numeric:!0,disablePadding:!1,label:"\u041a\u0443\u043f\u043e\u043d"},{id:"couponPercent",numeric:!0,disablePadding:!1,label:"\u0414\u043e\u0445\u043e\u0434\u043d\u043e\u0441\u0442\u044c"}];function L(e,n,t){return n[t]<e[t]?-1:n[t]>e[t]?1:0}var U=t(154),_=Object(U.a)((function(e){return{root:{width:"100%"},paper:{width:"100%",marginBottom:e.spacing(2)},table:{minWidth:750},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1}}})),Y=function(e){var n=_(),t=o.a.useState("asc"),a=Object(d.a)(t,2),r=a[0],c=a[1],i=o.a.useState("calories"),u=Object(d.a)(i,2),l=u[0],s=u[1],m=o.a.useState(0),f=Object(d.a)(m,2),p=f[0],b=f[1],h=o.a.useState(10),E=Object(d.a)(h,2),v=E[0],g=E[1],O=e.bonds;return o.a.createElement(o.a.Fragment,null,o.a.createElement(A.a,null,o.a.createElement(C.a,{size:"small"},o.a.createElement(R,{classes:n,columns:e.columns||S,order:r,orderBy:l,onRequestSort:function(e,n){c(l===n&&"asc"===r?"desc":"asc"),s(n)},rowCount:O.length}),o.a.createElement(w.a,null,function(e,n){var t=e.map((function(e,n){return[e,n]}));return t.sort((function(e,t){var a=n(e[0],t[0]);return 0!==a?a:e[1]-t[1]})),t.map((function(e){return e[0]}))}(O,function(e,n){return"desc"===e?function(e,t){return L(e,t,n)}:function(e,t){return-L(e,t,n)}}(r,l)).slice(p*v,p*v+v).map((function(n){return o.a.createElement(I,{key:n.name,row:n,columns:e.columns||S})}))))),o.a.createElement(x.a,{rowsPerPageOptions:[10,15,20,25,30],component:"div",count:O.length,rowsPerPage:v,page:p,onChangePage:function(e,n){b(n)},onChangeRowsPerPage:function(e){g(parseInt(e.target.value,10)),b(0)}}))},G=t(71),V=t.n(G),W=(t(108),function(){var e=Object(r.useContext)(h),n=e.bonds,t=e.portfolio,a=e.setPortfolio;return o.a.createElement("div",null,o.a.createElement(Y,{bonds:n,columns:[{id:"name",numeric:!1,disablePadding:!1,label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",template:function(e){return o.a.createElement(T.a,{target:"_blank",href:"https://www.moex.com/ru/issue.aspx?board=".concat(e.board,"&code=").concat(e.isin)},e.name)}},{id:"expireDate",numeric:!0,disablePadding:!1,label:"\u041f\u043e\u0433\u0430\u0448\u0435\u043d\u0438\u0435"},{id:"couponCount",numeric:!0,disablePadding:!1,label:"\u041a\u0443\u043f\u043e\u043d\u043e\u0432"},{id:"couponPeriod",numeric:!0,disablePadding:!1,label:"\u041f\u0435\u0440\u0438\u043e\u0434"},{id:"coupon",numeric:!0,disablePadding:!1,label:"\u041a\u0443\u043f\u043e\u043d"},{id:"couponAccumulated",numeric:!0,disablePadding:!1,label:"\u041d\u041a\u0414"},{id:"price",numeric:!0,disablePadding:!1,label:"\u0422\u0435\u043a.\u0426\u0435\u043d\u0430"},{id:"couponPercent",numeric:!0,disablePadding:!1,label:"\u0414\u043e\u0445\u043e\u0434\u043d\u043e\u0441\u0442\u044c"},{id:"isin",numeric:!1,disablePadding:!1,template:function(e){return o.a.createElement(T.a,{className:"add-link",onClick:function(){return function(e){var n=t.concat(),r=n.filter((function(n){return n.bond.isin==e.isin}));r.length?r[0].count++:n.push({count:1,bond:e}),a(n)}(e)}},o.a.createElement(V.a,null))}}]}))}),H=t(161),K=t(168),Q=t(162),X=t(166),q=["\u042f\u043d\u0432","\u0424\u0435\u0432","\u041c\u0430\u0440","\u0410\u043f\u0440","\u041c\u0430\u0439","\u0418\u044e\u043d","\u0418\u044e\u043b","\u0410\u0432\u0433","\u0421\u0435\u043d","\u041e\u043a\u0442","\u041d\u043e\u044f","\u0414\u0435\u043a"],J=(t(110),function(){var e=Object(r.useContext)(h),n=e.filter,t=e.setFilter;return o.a.createElement("div",{className:"filter"},o.a.createElement(H.a,{className:"select-month"},o.a.createElement(K.a,{id:"filter-month"},"\u041c\u0435\u0441\u044f\u0446 \u0432\u044b\u043f\u043b\u0430\u0442"),o.a.createElement(Q.a,{labelId:"filter-month",value:n.month||0,onChange:function(e){var a=e.target.value,r=Object(f.a)({},n);r.month=a,t(r)}},o.a.createElement(X.a,{value:0},"\u0412\u0441\u0435"),q.map((function(e,n){return o.a.createElement(X.a,{value:n+1,key:n+1},e)})))))}),z=t(169),$=t(72),Z=t.n($),ee=(t(111),function(e){var n=e.bond,t=e.count,a=e.changeCount,r=e.removeItem;return o.a.createElement("div",{className:"bond"},o.a.createElement("div",{className:"name"},o.a.createElement(T.a,{className:"remove-item",onClick:function(){return r(n)}},o.a.createElement(Z.a,null)),n.name," (",n.expireDate,")"),o.a.createElement("div",{className:"coupon"},n.couponPercent,"%"),o.a.createElement("div",{className:"count"},o.a.createElement(z.a,{type:"number",value:t,onChange:function(e){return a(e,n)}})),o.a.createElement("div",{className:"cost"},function(e,n){var t=parseFloat(e.value),a=parseFloat(e.price),r=parseFloat(e.couponAccumulated);return Math.round(t*a*n/100)+r*n}(n,t)," \u0440."))}),ne=(t(112),function(e){var n=Object(r.useContext)(h),t=n.portfolio,a=n.setPortfolio,c=function(e,n){var r=t.concat();r.filter((function(e){return e.bond.isin==n.isin}))[0].count=e.target.value,a(r)},i=function(e){var n=t.concat().filter((function(n){return n.bond.isin!=e.isin}));a(n)};return o.a.createElement("div",{className:"portfolio"},o.a.createElement("h2",null,"\u041f\u043e\u0440\u0442\u0444\u0435\u043b\u044c"),!!t.length&&o.a.createElement("div",{className:"list"},t.map((function(e){return o.a.createElement(ee,{key:e.bond.isin,bond:e.bond,count:e.count,changeCount:c,removeItem:i})})),o.a.createElement("div",{className:"total"},function(){var e=0;return t.map((function(n){return e+=function(e,n){var t=parseFloat(e.value),a=parseFloat(e.price),r=parseFloat(e.couponAccumulated);return Math.round(t*a*n/100)+r*n}(n.bond,n.count)})),Math.round(100*e)/100}()," \u0440.")),!t.length&&o.a.createElement("p",{className:"empty"},"\u0417\u0434\u0435\u0441\u044c \u043f\u043e\u043a\u0430 \u043f\u0443\u0441\u0442\u043e"))}),te=t(53),ae=(t(113),function(){var e=Object(r.useContext)(h).portfolio,n={},t=0,a=function(e){return n[e]?n[e].coupon:0},c=function(e){var n=100*a(e)/t;return n<8&&(n=8),n+"%"};e.map((function(e){e.bond.months.map((function(t){n[t]||(n[t]={items:[],coupon:0}),n[t].items.push(e),n[t].coupon=function(e){var n=0;return e.map((function(e){n+=e.count*parseFloat(e.bond.coupon)})),Math.round(n)}(n[t].items)}))}));var i=Object.keys(n).map((function(e){return n[e].coupon}));return t=Math.max.apply(Math,Object(te.a)(i)),o.a.createElement("div",{className:"chart-container"},o.a.createElement("h2",null,"\u0412\u044b\u043f\u043b\u0430\u0442\u044b"),o.a.createElement("div",{className:"chart"},q.map((function(e,n){return o.a.createElement("div",{key:e,className:"month",style:{height:c(n+1)}},o.a.createElement("div",{className:"price"},a(n+1),"\u0440"),o.a.createElement("div",{className:"label"},e))}))))}),re=(t(114),t(115),function(){var e=Object(r.useContext)(h).portfolio,n=[],t=[],a=e.map((function(e){return Object(f.a)(Object(f.a)({},e.bond),{},{count:e.count})})).sort((function(e,n){return e.expireDate<n.expireDate?-1:1}));a.length&&function(){var e=new Date,r=e.getMonth()+1,o=function(e,n){var t;return t=12*(n.getFullYear()-e.getFullYear()),t-=e.getMonth(),(t+=n.getMonth())<=0?0:t}(e,new Date(a[a.length-1].expireDate));t=new Array(o+1);for(var c=0;c<a.length;c++)for(var i=a[c],u=i.months.filter((function(e){return e>r})),l=u.length?i.months.indexOf(u[0]):0,s=0,d=i.months[l]-r,m=i.months.length>1?i.months[1]-i.months[0]:0,f=0;f<i.couponCount;f++)s=i.months[l],n.push({bond:i,month:s,inMonths:d,type:"coupon",value:i.coupon*i.count}),++l>=i.months.length&&(l=0),f==i.couponCount-1&&n.push({bond:i,month:s,inMonths:d,type:"expiration",value:i.value*i.count}),d+=m;n.sort((function(e,n){return e.inMonths<n.inMonths?-1:1}));for(var p=function(e){var a,r=n.filter((function(n){return n.inMonths<e+1}));t[e]=(a=r.map((function(e){return e.value}))).length?Math.round(100*a.reduce((function(e,n){return e+n})))/100:0},b=0;b<t.length;b++)p(b)}();var c=function(e){return Math.round(100*e)/100},i=function(){var n=0;return e.map((function(e){return n+=function(e,n){var t=parseFloat(e.value),a=parseFloat(e.price),r=parseFloat(e.couponAccumulated);return Math.round(t*a*n/100)+r*n}(e.bond,e.count)})),Math.round(100*n)/100}(),u=t[t.length-1]||0,l=c(u-i),s=l>0?c(u/i*100):0,d=t.length>100?t.concat().splice(t.length-100):t,m=c(t.length/12),p=i>0?c(Math.log(u/i)/m*100):0;return o.a.createElement("div",{className:"chart-cumulative-container"},o.a.createElement("h2",null,"\u0412\u043e\u0437\u0432\u0440\u0430\u0442"),o.a.createElement("p",null,"\u0427\u0435\u0440\u0435\u0437 ",t.length," \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u0432\u043e\u0437\u0432\u0440\u0430\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432 \u0441\u043e\u0441\u0442\u0430\u0432\u0438\u0442 ",u,"\u0440. \u041f\u0440\u0438\u0431\u044b\u043b\u044c ",l,"\u0440. (",s,"%). \u0418\u043b\u0438 \u0447\u0435\u0440\u0435\u0437 ",m," \u043b\u0435\u0442 ",p,"% \u0433\u043e\u0434\u043e\u0432\u044b\u0445."),o.a.createElement("div",{className:"chart-cumulative"},d.map((function(e,n){return o.a.createElement("div",{key:n,className:"chart-cumulative-bar",style:{height:(t=e,100*t/d[d.length-1]+"%")}},o.a.createElement("div",{className:"return"},e),o.a.createElement("div",{className:"month"},n+1));var t}))))}),oe=function(){var e=Object(r.useContext)(h).getBonds;return Object(r.useEffect)((function(){e()}),[]),o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"portfolio-chart"},o.a.createElement(ae,null)),o.a.createElement("div",{className:"returns-chart"},o.a.createElement(re,null)),o.a.createElement("div",{className:"bonds-filter"},o.a.createElement(J,null)),o.a.createElement("div",{className:"bonds-list"},o.a.createElement(W,null)),o.a.createElement("div",{className:"portfolio-list"},o.a.createElement(ne,null)))};var ce=function(){return o.a.createElement(D,null,o.a.createElement(oe,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(ce,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},80:function(e,n,t){e.exports=t(116)},85:function(e,n,t){},86:function(e,n,t){}},[[80,1,2]]]);
//# sourceMappingURL=main.58bdb5c0.chunk.js.map